name: Deploy Production build

on:
  push:
    tags:
      - 'v[0-9]+.[0-9]+.[0-9]+'
  workflow_dispatch:
    inputs:
      environment:
        type: environment
        required: true
        default: production
jobs:
  setup:
    runs-on: ubuntu-latest
    environment: ${{ inputs.environment || 'production' }}
    env:
      DGN: ${{ vars.DGN || 'production' }}
    strategy:
      matrix:
        node-version: [20.x]
    permissions:
      id-token: write
      contents: read
      packages: read

    steps:
      - name: Checkout
        uses: actions/checkout@v4
        with:
          fetch-depth: 0
          persist-credentials: false

      - name: Setup Node.js (Dummy)
        uses: actions/setup-node@v3
        with:
          node-version: ${{ matrix.node-version }}

      - name: Test Tag Trigger (Dummy)
        run: |
          echo "ðŸš€ Testing auto-trigger on tag creation!"
          echo "Tag: ${{ github.ref_name }}"
          echo "Repository: ${{ github.repository }}"
          echo "Workflow: ${{ github.workflow }}"
          echo "Actor: ${{ github.actor }}"
          echo "Event: ${{ github.event_name }}"
          echo "âœ… Dummy deployment test completed successfully!"

      - name: Simulate Build Process (Dummy)
        run: |
          echo "ðŸ“¦ Simulating build process..."
          echo "Node version: $(node --version)"
          echo "NPM version: $(npm --version)"
          echo "Current directory: $(pwd)"
          echo "Files in current directory:"
          ls -la
          echo "âœ… Build simulation completed!"

      - name: Simulate Deployment (Dummy)
        run: |
          echo "ðŸš€ Simulating deployment process..."
          echo "Environment: ${{ inputs.environment || 'production' }}"
          echo "DGN: ${{ vars.DGN || 'production' }}"
          echo "Would deploy to: s3://dummy-bucket/test-release-please"
          echo "âœ… Deployment simulation completed!"
